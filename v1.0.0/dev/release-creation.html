

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.8. Creating a Release &mdash; Syncthing v1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/syncthing.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Syncthing v1 documentation" href="../index.html"/>
        <link rel="up" title="3. Development" href="index.html"/>
        <link rel="next" title="3.9. Release Signing" href="release-signing.html"/>
        <link rel="prev" title="3.7. Issue Management" href="issues.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Syncthing
          

          
          </a>

          
            
            
              <div class="version">
                v1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/index.html">2. Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">3.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html">3.2. Building Syncthing</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">3.3. Contribution Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">3.4. Debugging Syncthing</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-ids.html">3.5. Understanding Device IDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="infrastructure.html">3.6. Syncthing Infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="issues.html">3.7. Issue Management</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.8. Creating a Release</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">3.8.1. Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#release-procedure">3.8.2. Release Procedure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#release-candidates-write-a-change-log">Release Candidates - Write a Change Log</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stable-release-write-a-change-log">Stable Release - Write a Change Log</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prepare-the-release-branch">Prepare the Release Branch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-and-push-the-tag">Create and Push the Tag</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-the-packages">Build the Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-github-release">Create the GitHub release</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sign-and-upload-the-archives">Sign and upload the archives</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stable-releases-create-a-post-on-the-forum">Stable Releases - Create a post on the forum</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stable-releases-optionally-tweet-it">Stable Releases - Optionally, tweet it</a></li>
<li class="toctree-l4"><a class="reference internal" href="#merge-release-into-master">Merge Release Into Master</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release-signing.html">3.9. Release Signing</a></li>
<li class="toctree-l2"><a class="reference internal" href="rest.html">3.10. REST API</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html">3.11. Event API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../specs/index.html">4. Specifications</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Syncthing</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">3. </span>Development</a> &raquo;</li>
        
      <li><span class="section-number">3.8. </span>Creating a Release</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/syncthing/docs/blob/master/dev/release-creation.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="creating-a-release">
<h1><span class="section-number">3.8. </span>Creating a Release<a class="headerlink" href="#creating-a-release" title="Permalink to this headline">¶</a></h1>
<section id="prerequisites">
<h2><span class="section-number">3.8.1. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>About ten minutes to half an hour of free time.</p></li>
<li><p>The master branch in a clean and buildable state, full of commits you are proud of and know the users will love. This is of course the default state at any given time.</p></li>
<li><p>A normal computer (real or virtual) that has a command line and can run bash scripts. Macs and Linux boxes are good choices here. If you know what you’re doing I’m sure it’s entirely possible to do it on Windows as well - but then you’re on your own. In a pinch you can use <code class="docutils literal notranslate"><span class="pre">secure.syncthing.net</span></code> as it has all the required tools installed, although you’ll need to add your git config, keys etc.</p></li>
<li><p>The source repo, Git, Go, and GPG. It doesn’t much matter which version of Go, we are not going to be building the release artifacts with it. If you can build the project you are good to go. If you can’t build it, please don’t attempt to make a release of it.</p></li>
<li><p>Push access to the repo, being able to bypass the pull request requirements. This means <code class="docutils literal notranslate"><span class="pre">admin</span></code> or <code class="docutils literal notranslate"><span class="pre">maintainers</span></code> group.</p></li>
<li><p>An account on <code class="docutils literal notranslate"><span class="pre">secure.syncthing.net</span></code> with sudo access.</p></li>
<li><p>A TeamCity account on <code class="docutils literal notranslate"><span class="pre">build.syncthing.net</span></code> with deploy access.</p></li>
</ul>
</section>
<section id="release-procedure">
<h2><span class="section-number">3.8.2. </span>Release Procedure<a class="headerlink" href="#release-procedure" title="Permalink to this headline">¶</a></h2>
<p>The procedure differs sligthly depending on whether we’re doing a release candidate or a stable release. Candidate releases require work to prepare the changelog, which will just be reused for the stable release. The stable release on the other hand requires a slightly different release process and is announced more widely.</p>
<section id="release-candidates-write-a-change-log">
<h3>Release Candidates - Write a Change Log<a class="headerlink" href="#release-candidates-write-a-change-log" title="Permalink to this headline">¶</a></h3>
<p>Most of the change log is machine generated from the closed issues. We do however need to make sure that issues belong to the correct milestone, have the correct labels, and that the issue subject makes sense as a line in the change log. To our help we have the purpose written tool [grt](<a class="reference external" href="https://github./calmh/github-release-tool">https://github./calmh/github-release-tool</a>). The grt tool requires your GitHub token to manage milestones and issues; you set the environment variable <code class="docutils literal notranslate"><span class="pre">GITHUB_TOKEN</span></code> while you are working on the release (but hopefully not all the time - programs can and do steal environment data).</p>
<p>To ensure that all closed issues are tagged with the milestone for the release you are doing, use the following command. First, find the commit hash or tag of the last commit on the <em>previous</em> release - changes since this point is what we are going to consider part of this release. If there haven’t been any special releases or branching you can simply use the previous release as the starting point.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ grt milestone v0.14.50 --from<span class="o">=</span>v0.14.49
</pre></div>
</div>
<p>Visit the milestone in your browser and double check the issue subjects and labels. Remember that only closed issues (not pull requests) will appear in the change log. You can preview the change log using grt:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ grt changelog v0.14.50
Bugfixes:

 - <span class="c1">#5063: panic: cannot start already running folder</span>
 - <span class="c1">#5073: lib/logger: tests fail due to compilation error with go 1.11</span>
</pre></div>
</div>
<p>Now write a changelog.txt. Look at the previous ones for inspiration; they are in the tag message for each recent previous release. The first line is the version being described. Then start with a sentence describing the release type (scheduled feature and bugfix, hotfix, …) and who should use it. Follow with the set of issues closed since last release - just pipe the output from <code class="docutils literal notranslate"><span class="pre">grt</span> <span class="pre">changelog</span></code> here.</p>
<p>Add further notes or commentary to taste, if required.</p>
</section>
<section id="stable-release-write-a-change-log">
<h3>Stable Release - Write a Change Log<a class="headerlink" href="#stable-release-write-a-change-log" title="Permalink to this headline">¶</a></h3>
<p>Use the change log from the corresponding release candidate, just change the version in the first line and the first sentence that describes the release status.</p>
</section>
<section id="prepare-the-release-branch">
<h3>Prepare the Release Branch<a class="headerlink" href="#prepare-the-release-branch" title="Permalink to this headline">¶</a></h3>
<p>Releases come from the <code class="docutils literal notranslate"><span class="pre">release</span></code> branch. If you are making a new candidate release you will want to fast forward <code class="docutils literal notranslate"><span class="pre">release</span></code> to point at current <code class="docutils literal notranslate"><span class="pre">master</span></code> <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>. If you are making a stable release from the latest RC the <code class="docutils literal notranslate"><span class="pre">release</span></code> branch is already in the right place.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout release
$ git merge --ff-only master
</pre></div>
</div>
<p>If there’s been some funky business with the <code class="docutils literal notranslate"><span class="pre">release</span></code> branch and it can’t be fast forwarded to <code class="docutils literal notranslate"><span class="pre">master</span></code>, 1) the previous release manager screwed up, 2) don’t do a merge, just reset the branch to the right place.</p>
<p>Don’t push the branch yet, we want to create the tag first.</p>
</section>
<section id="create-and-push-the-tag">
<h3>Create and Push the Tag<a class="headerlink" href="#create-and-push-the-tag" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git tag -a -s -F ~/changelog.txt v0.14.50
$ git push --tags
$ git push origin release:release
</pre></div>
</div>
<p>The changelog file is the one you prepared previously.</p>
<p>You will need your PGP key at hand for this step. It should be your personal PGP key, whatever you would normally use. If you don’t have one you’ll need to create one for the purpose. Keep it around, keep it secure, upload the public part to a key server.</p>
<p>If your remote spec is nondefault, tailor the push command to suit.</p>
</section>
<section id="build-the-packages">
<h3>Build the Packages<a class="headerlink" href="#build-the-packages" title="Permalink to this headline">¶</a></h3>
<p>If you are building a release candidate and fast forwarded the <code class="docutils literal notranslate"><span class="pre">release</span></code> branch the build server will already have started building it. If not, jump in on the build server and trigger the Release/Syncthing job, for the <code class="docutils literal notranslate"><span class="pre">release</span></code> branch, while checking the options to rebuild all dependencies in the chain. We need the rebuild for those binaries to pick up the new tag.</p>
<p>Once the build succeds, log in on <code class="docutils literal notranslate"><span class="pre">secure.syncthing.net</span></code>. If something failed in the build it’s hopefully “just” a flaky test - redo the build.</p>
</section>
<section id="create-the-github-release">
<h3>Create the GitHub release<a class="headerlink" href="#create-the-github-release" title="Permalink to this headline">¶</a></h3>
<p>From this point on we will work on <code class="docutils literal notranslate"><span class="pre">secure.s.n</span></code>, as the <code class="docutils literal notranslate"><span class="pre">release</span></code> user.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jb@laptop$ ssh secure.syncthing.net
jb@secure$ sudo su - release
release@secure$
</pre></div>
</div>
<p>We will use grt to create the release with the appropriate change log, and possibly close the milestone. If we are doing a candidate release we need to tell grt about that:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ grt release v0.14.50 --to<span class="o">=</span>v0.14.50-rc.1
</pre></div>
</div>
<p>This will create a v0.14.50-rc.1 release, with the “pre-release” bit set, and leave the v0.14.50 milestone open. For a stable release:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ grt release v0.14.50
</pre></div>
</div>
<p>The milestone will be closed.</p>
</section>
<section id="sign-and-upload-the-archives">
<h3>Sign and upload the archives<a class="headerlink" href="#sign-and-upload-the-archives" title="Permalink to this headline">¶</a></h3>
<p>At this point the build should haver completed and the artifacts be uploaded to <code class="docutils literal notranslate"><span class="pre">secure.s.n</span></code>. If the build number was 1234 and the version v0.14.50 the files will be in <code class="docutils literal notranslate"><span class="pre">/home/incoming/build-1234-v0.14.50</span></code>. Run the following scripts. None of them should fail, barring connectivity issues - so if they do, you get to fix whatever it is without any guidance from me. Sorry.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sign-upload-debian /home/incoming/build-1234-v0.14.50
</pre></div>
</div>
<p>Publishes the Debian archives to apt.syncthing.net.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ upload-snaps /home/incoming/build-1234-v0.14.50
</pre></div>
</div>
<p>Publishes the Snap packages to Ubuntu.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sign-upload-release /home/incoming/build-1234-v0.14.50
</pre></div>
</div>
<p>Publishes the regular release archives to GitHub.</p>
</section>
<section id="stable-releases-create-a-post-on-the-forum">
<h3>Stable Releases - Create a post on the forum<a class="headerlink" href="#stable-releases-create-a-post-on-the-forum" title="Permalink to this headline">¶</a></h3>
<p>In the Announce/Releases category. Use the tag message as the template, make the header a link to the release, make the issue numbers to be links to the corresponding issues. You can use <code class="docutils literal notranslate"><span class="pre">grt</span> <span class="pre">changelog</span> <span class="pre">v0.14.50</span> <span class="pre">--md</span></code> to get the change log with issue links in proper Markdown.</p>
</section>
<section id="stable-releases-optionally-tweet-it">
<h3>Stable Releases - Optionally, tweet it<a class="headerlink" href="#stable-releases-optionally-tweet-it" title="Permalink to this headline">¶</a></h3>
<p>If you have the Twitter account and the release isn’t a cake-in-your-face screwup fix that you’d rather no one ever heard about and want to just silently roll out to everyone during the night.</p>
</section>
<section id="merge-release-into-master">
<h3>Merge Release Into Master<a class="headerlink" href="#merge-release-into-master" title="Permalink to this headline">¶</a></h3>
<p>If this was a non-first candidate release with cherry picked commits on it, merge <code class="docutils literal notranslate"><span class="pre">release</span></code> back into <code class="docutils literal notranslate"><span class="pre">master</span></code> and push <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p>
</section>
</section>
</section>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="release-signing.html" class="btn btn-neutral float-right" title="3.9. Release Signing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="issues.html" class="btn btn-neutral" title="3.7. Issue Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/version_redirect.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>