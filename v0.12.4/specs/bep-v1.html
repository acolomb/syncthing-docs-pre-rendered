

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Block Exchange Protocol v1 &mdash; Syncthing v0.12 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/syncthing.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Syncthing v0.12 documentation" href="../index.html"/>
        <link rel="next" title="Global Discovery v3" href="globaldisco-v3.html"/>
        <link rel="prev" title="Specifications" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Syncthing
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/getting-started.html#installing">Installing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro/getting-started.html#syncthing">Syncthing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../intro/getting-started.html#configuring">Configuring</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro/gui.html">An intro to the GUI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/gui.html#folder-view">Folder View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/gui.html#device-view">Device View</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro/project-presentation.html">Project Presentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/project-presentation.html#syncthing">Syncthing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/project-presentation.html#syncthing-android">syncthing-android</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/project-presentation.html#syncthing-inotify">syncthing-inotify</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/project-presentation.html#syncthing-gtk">Syncthing-GTK</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users/syncthing.html">Command Line Operation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/syncthing.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/syncthing.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/syncthing.html#options">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/syncthing.html#exit-codes">Exit Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/syncthing.html#development-settings">Development Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/syncthing.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#config-file-format">Config File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#configuration-element">Configuration Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#folder-element">Folder Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#device-element">Device Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#gui-element">GUI Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#options-element">Options Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/config.html#syncing-configuration-files">Syncing Configuration files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/faq.html#general">General</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#what-is-syncthing">What is Syncthing?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#is-it-syncthing-syncthing-or-syncthing">Is it “syncthing”, “Syncthing” or “SyncThing”?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#how-does-syncthing-differ-from-bittorrent-sync">How does Syncthing differ from BitTorrent Sync?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/faq.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#what-things-are-synced">What things are synced?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#is-synchronization-fast">Is synchronization fast?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#should-i-keep-my-device-ids-secret">Should I keep my device IDs secret?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#what-if-there-is-a-conflict">What if there is a conflict?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#how-to-configure-multiple-users-on-a-single-machine">How to configure multiple users on a single machine?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#is-syncthing-my-ideal-backup-application">Is Syncthing my ideal backup application?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#why-is-there-no-ios-client">Why is there no iOS client?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#why-does-it-use-so-much-cpu">Why does it use so much CPU?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#how-can-i-exclude-files-with-brackets-in-the-name">How can I exclude files with brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) in the name?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#why-is-the-setup-more-complicated-than-btsync">Why is the setup more complicated than BTSync?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#how-do-i-access-the-web-gui-from-another-computer">How do I access the web GUI from another computer?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#why-do-i-see-syncthing-twice-in-task-manager">Why do I see Syncthing twice in task manager?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#where-do-syncthing-logs-go-to">Where do Syncthing logs go to?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#how-do-i-upgrade-syncthing">How do I upgrade Syncthing?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/faq.html#where-do-i-find-the-latest-release">Where do I find the latest release?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/firewall.html">Firewall Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/firewall.html#port-forwards">Port Forwards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/firewall.html#local-firewall">Local Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/firewall.html#remote-web-gui">Remote Web GUI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/firewall.html#tunneling-via-ssh">Tunneling via SSH</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/advanced.html">Advanced Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/advanced.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/advanced.html#per-folder-settings">Per Folder Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../advanced/folder-autonormalize.html">autoNormalize</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../advanced/folder-autonormalize.html#background">Background</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../advanced/folder-ignoredelete.html">ignoreDelete</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../advanced/folder-ignoredelete.html#example-scenario">Example Scenario</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/autostart.html">Starting Syncthing Automatically</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/autostart.html#windows">Windows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#third-party-tools">Third-party Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#start-on-login">Start on Login</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#run-independent-of-user-login">Run independent of user login</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/autostart.html#mac-os-x">Mac OS X</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#using-homebrew">Using homebrew</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#without-homebrew">Without homebrew</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/autostart.html#linux">Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#on-ubuntu-like-systems">On Ubuntu-like systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#using-supervisord">Using Supervisord</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/autostart.html#using-systemd">Using systemd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../users/autostart.html#how-to-set-up-a-system-service">How to set up a system service</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/autostart.html#how-to-set-up-a-user-service">How to set up a user service</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/autostart.html#checking-the-service-status">Checking the service status</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/autostart.html#using-the-journal">Using the journal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/autostart.html#permissions">Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../users/autostart.html#debugging">Debugging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/contrib.html">Community Contributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/contrib.html#gui-wrappers">GUI Wrappers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#cross-platform">Cross-platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#android">Android</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#windows">Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#os-x">OS X</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#kindle-touch">Kindle Touch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/contrib.html#packages-and-bundlings">Packages and Bundlings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#debian-ubuntu">Debian / Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#archlinux">ArchLinux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#arkos">arkOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#gentoo">Gentoo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#freebsd">FreeBSD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#opensuse">OpenSUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#synology-nas">Synology NAS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#qnap-nas">QNAP NAS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/contrib.html#integrations">Integrations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#rest-api-bindings">REST API Bindings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#ports">Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/contrib.html#configuration-management">Configuration management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/contrib.html#older-possibly-unmaintained">Older, Possibly Unmaintained</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/custom-upgrades.html">Custom Upgrade Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/custom-upgrades.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/custom-upgrades.html#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/discosrv.html">Running a Discovery Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/discosrv.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/discosrv.html#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/discosrv.html#configuring">Configuring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/discosrv.html#certificates">Certificates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/discosrv.html#pointing-syncthing-at-your-discovery-server">Pointing Syncthing at Your Discovery Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/foldermaster.html">Folder Master</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users/ignoring.html">Ignoring Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/ignoring.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/ignoring.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/ignoring.html#patterns">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/ignoring.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/ignoring.html#effects-on-in-sync-status">Effects on “In Sync” Status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/relaying.html">Relaying</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/relaying.html#security">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/relaying.html#running-your-own-relay">Running Your Own Relay</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/reverseproxy.html">Reverse Proxy Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/reverseproxy.html#server-configuration">Server Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/reverseproxy.html#apache">Apache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/reverseproxy.html#nginx">Nginx</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/reverseproxy.html#folder-configuration">Folder Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/reverseproxy.html#id2">Apache</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/security.html">Security Principles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/security.html#information-leakage">Information Leakage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/security.html#global-discovery">Global Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/security.html#local-discovery">Local Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/security.html#upgrade-checks">Upgrade Checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/security.html#usage-reporting">Usage Reporting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/security.html#sync-connections-bep">Sync Connections (BEP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../users/security.html#web-gui">Web GUI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../users/security.html#in-short">In Short</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../users/versioning.html">File Versioning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../users/versioning.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/versioning.html#trash-can-file-versioning">Trash Can File Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/versioning.html#simple-file-versioning">Simple File Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/versioning.html#staggered-file-versioning">Staggered File Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/versioning.html#external-file-versioning">External File Versioning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../users/versioning.html#example-for-unixes">Example for Unixes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/intro.html#controlling-syncthing-from-external-applications">Controlling Syncthing from External Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/intro.html#contributing-to-the-syncthing-core">Contributing to the Syncthing Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/intro.html#source-code-layout">Source Code Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/intro.html#why-are-you-being-so-hard-on-my-pull-request">Why are you being so hard on my pull request?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/building.html">Building Syncthing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#branches-and-tags">Branches and Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#building-unix">Building (Unix)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#building-windows">Building (Windows)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#subcommands-and-options">Subcommands and Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#building-without-git">Building without Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/building.html#building-with-docker">Building with Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/contributing.html">Contribution Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#authorship">Authorship</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#team-membership">Team Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#code-review">Code Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#coding-style">Coding Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/contributing.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/contributing.html#go-specific">Go Specific</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#commits">Commits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#tests">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#branches">Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#tags">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/contributing.html#licensing">Licensing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/debugging.html">Debugging Syncthing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/debugging.html#environment-variables">Environment Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#sttrace">STTRACE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stprofiler">STPROFILER</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stguiassets">STGUIASSETS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stcpuprofile">STCPUPROFILE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stheapprofile">STHEAPPROFILE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stblockprofile">STBLOCKPROFILE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stperfstats">STPERFSTATS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#stnoupgrade">STNOUPGRADE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#gomaxprocs">GOMAXPROCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/debugging.html#gogc">GOGC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/device-ids.html">Understanding Device IDs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/device-ids.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/device-ids.html#keys">Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/device-ids.html#id1">Device IDs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/device-ids.html#connection-establishment">Connection Establishment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev/device-ids.html#an-aside-about-collisions">An Aside About Collisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/device-ids.html#problems-and-vulnerabilities">Problems and Vulnerabilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/device-ids.html#discovery-spoofing">Discovery Spoofing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/device-ids.html#long-device-ids-are-painful">Long Device IDs are Painful</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/events.html">Event API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/events.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/events.html#event-structure">Event Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/events.html#events">Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../events/configsaved.html">ConfigSaved</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/deviceconnected.html">DeviceConnected</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/devicedisconnected.html">DeviceDisconnected</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/devicediscovered.html">DeviceDiscovered</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/devicerejected.html">DeviceRejected</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/downloadprogress.html">DownloadProgress</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/foldercompletion.html">FolderCompletion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/foldererrors.html">FolderErrors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/folderrejected.html">FolderRejected</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/foldersummary.html">FolderSummary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/itemfinished.html">ItemFinished</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/itemstarted.html">ItemStarted</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/localindexupdated.html">LocalIndexUpdated</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/ping.html">Ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/remoteindexupdated.html">RemoteIndexUpdated</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/starting.html">Starting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/startupcomplete.html">StartupComplete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../events/statechanged.html">StateChanged</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/infrastructure.html">Syncthing Infrastructure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#github">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#main-documenatation-websites">Main &amp; Documenatation Websites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#forum-website">Forum Website</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#global-discovery-servers">Global Discovery Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#relay-pool-server">Relay Pool Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#relay-servers">Relay Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#usage-reporting-server">Usage Reporting Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#build-servers-core-and-android">Build Servers, Core and Android</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#apt-server">APT Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/infrastructure.html#signing-server">Signing Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/issues.html">Issue Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/issues.html#labels">Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/issues.html#milestone">Milestone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/issues.html#assignee">Assignee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/issues.html#locking">Locking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/jenkins.html">Interacting with Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release-creation.html">Creating a Release</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-creation.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-creation.html#process">Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release-schedule.html">Release Schedule</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-schedule.html#structure">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-schedule.html#patch-releases">Patch Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-schedule.html#minor-releases">Minor Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-schedule.html#major-releases">Major Releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release-signing.html">Release Signing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-signing.html#checksum-files">Checksum Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/release-signing.html#binary-signing">Binary Signing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/release-signing.html#creating-and-verifying-binary-signatures-manually">Creating and Verifying Binary Signatures Manually</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/rest.html">REST API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/rest.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/rest.html#api-key">API Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/rest.html#system-endpoints">System Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-config-get.html">GET /rest/system/config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-config-insync-get.html">GET /rest/system/config/insync</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-config-post.html">POST /rest/system/config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-connections-get.html">GET /rest/system/connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-debug-get.html">GET /rest/system/debug</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-debug-post.html">POST /rest/system/debug</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-discovery-get.html">GET /rest/system/discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-discovery-post.html">POST /rest/system/discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-error-clear-post.html">POST /rest/system/error/clear</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-error-get.html">GET /rest/system/error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-error-post.html">POST /rest/system/error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-log-get.html">GET /rest/system/log</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-ping-get.html">GET /rest/system/ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-ping-post.html">POST /rest/system/ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-reset-post.html">POST /rest/system/reset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-restart-post.html">POST /rest/system/restart</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-shutdown-post.html">POST /rest/system/shutdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-status-get.html">GET /rest/system/status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-upgrade-get.html">GET /rest/system/upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-upgrade-post.html">POST /rest/system/upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/system-version-get.html">GET /rest/system/version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev/rest.html#database-endpoints">Database Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-browse-get.html">GET /rest/db/browse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-completion-get.html">GET /rest/db/completion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-file-get.html">GET /rest/db/file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-ignores-get.html">GET /rest/db/ignores</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-ignores-post.html">POST /rest/db/ignores</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-need-get.html">GET /rest/db/need</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-prio-post.html">POST /rest/db/prio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-scan-post.html">POST /rest/db/scan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/db-status-get.html">GET /rest/db/status</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev/rest.html#statistics-endpoints">Statistics Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rest/stats-device-get.html">GET /rest/stats/device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/stats-folder-get.html">GET /rest/stats/folder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev/rest.html#misc-services-endpoints">Misc Services Endpoints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rest/svc-deviceid-get.html">GET /rest/svc/deviceid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/svc-lang-get.html">GET /rest/svc/lang</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rest/svc-report-get.html">GET /rest/svc/report</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specifications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Specifications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Block Exchange Protocol v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-and-definitions">Introduction and Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transport-and-authentication">Transport and Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#messages">Messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cluster-config-type-0">Cluster Config (Type = 0)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#graphical-representation">Graphical Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields-clusterconfigmessage">Fields (ClusterConfigMessage)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields-folder-structure">Fields (Folder Structure)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields-device-structure">Fields (Device Structure)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xdr">XDR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#index-type-1-and-index-update-type-6">Index (Type = 1) and Index Update (Type = 6)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Graphical Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields-index-message">Fields (Index Message)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields-fileinfo-structure">Fields (FileInfo Structure)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">XDR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#request-type-2">Request (Type = 2)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Graphical Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">XDR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#response-type-3">Response (Type = 3)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Graphical Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">XDR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ping-type-4">Ping (Type = 4)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#close-type-7">Close (Type = 7)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Graphical Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">Fields</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sharing-modes">Sharing Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#trusted">Trusted</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-only">Read Only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#message-limits">Message Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-exchange">Example Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples-of-strong-cipher-suites">Examples of Strong Cipher Suites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="globaldisco-v3.html">Global Discovery v3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="globaldisco-v3.html#announcements">Announcements</a></li>
<li class="toctree-l2"><a class="reference internal" href="globaldisco-v3.html#queries">Queries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="localdisco-v3.html">Local Discovery Protocol v3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="localdisco-v3.html#mode-of-operation">Mode of Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="localdisco-v3.html#device-id">Device ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="localdisco-v3.html#announcement-packet">Announcement packet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="relay-v1.html">Relay Protocol v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#what-is-a-relay">What is a relay?</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#operation-modes">Operation modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#identifying-the-connection-mode">Identifying the connection mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#protocol-mode">Protocol mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#permanent-protocol-submode">Permanent protocol submode</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#temporary-protocol-submode">Temporary protocol submode</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#example-exchange">Example Exchange</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#session-mode">Session mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#id1">Example Exchange</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#messages">Messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#header-structure">Header structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#ping-message-type-0">Ping message (Type = 0)</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#pong-message-type-1">Pong message (Type = 1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#joinrelayrequest-message-type-2">JoinRelayRequest message (Type = 2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#joinsessionrequest-message-type-3">JoinSessionRequest message (Type = 3)</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#response-message-type-4">Response message (Type = 4)</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#connectrequest-message-type-5">ConnectRequest message (Type = 5)</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay-v1.html#sessioninvitation-message-type-6">SessionInvitation message (Type = 6)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#how-syncthing-uses-relays-and-general-security">How syncthing uses relays, and general security</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay-v1.html#examples-of-strong-cipher-suites">Examples of Strong Cipher Suites</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Syncthing</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Block Exchange Protocol v1</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/syncthing/docs/blob/master/specs/bep-v1.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <section id="block-exchange-protocol-v1">
<span id="bep-v1"></span><h1>Block Exchange Protocol v1<a class="headerlink" href="#block-exchange-protocol-v1" title="Permalink to this headline">¶</a></h1>
<section id="introduction-and-definitions">
<h2>Introduction and Definitions<a class="headerlink" href="#introduction-and-definitions" title="Permalink to this headline">¶</a></h2>
<p>BEP is used between two or more <em>devices</em> thus forming a <em>cluster</em>. Each
device has one or more <em>folders</em> of files described by the <em>local
model</em>, containing metadata and block hashes. The local model is sent to
the other devices in the cluster. The union of all files in the local
models, with files selected for highest change version, forms the
<em>global model</em>. Each device strives to get its folders in sync with the
global model by requesting missing or outdated blocks from the other
devices in the cluster.</p>
<p>File data is described and transferred in units of <em>blocks</em>, each being
128 KiB (131072 bytes) in size.</p>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
“SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this
document are to be interpreted as described in RFC 2119.</p>
</section>
<section id="transport-and-authentication">
<h2>Transport and Authentication<a class="headerlink" href="#transport-and-authentication" title="Permalink to this headline">¶</a></h2>
<p>BEP is deployed as the highest level in a protocol stack, with the lower
level protocols providing encryption and authentication.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------|</span>
<span class="o">|</span>   <span class="n">Block</span> <span class="n">Exchange</span> <span class="n">Protocol</span>   <span class="o">|</span>
<span class="o">|-----------------------------|</span>
<span class="o">|</span> <span class="n">Encryption</span> <span class="o">&amp;</span> <span class="n">Auth</span> <span class="p">(</span><span class="n">TLS</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">|</span>
<span class="o">|-----------------------------|</span>
<span class="o">|</span>             <span class="n">TCP</span>             <span class="o">|</span>
<span class="o">|-----------------------------|</span>
<span class="n">v</span>             <span class="o">...</span>             <span class="n">v</span>
</pre></div>
</div>
<p>The encryption and authentication layer SHALL use TLS 1.2 or a higher
revision. A strong cipher suite SHALL be used, with “strong cipher
suite” being defined as being without known weaknesses and providing
Perfect Forward Secrecy (PFS). Examples of strong cipher suites are
given at the end of this document. This is not to be taken as an
exhaustive list of allowed cipher suites but represents best practices
at the time of writing.</p>
<p>The exact nature of the authentication is up to the application, however
it SHALL be based on the TLS certificate presented at the start of the
connection. Possibilities include certificates signed by a common
trusted CA, preshared certificates, preshared certificate fingerprints
or certificate pinning combined with some out of band first
verification. The reference implementation uses preshared certificate
fingerprints (SHA-256) referred to as “Device IDs”.</p>
<p>There is no required order or synchronization among BEP messages except
as noted per message type - any message type may be sent at any time and
the sender need not await a response to one message before sending
another.</p>
<p>The underlying transport protocol MUST be TCP.</p>
</section>
<section id="messages">
<h2>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<p>Every message starts with one 32 bit word indicating the message version, type
and ID, followed by the length of the message. The header is in network byte
order, i.e. big endian. In this document, in diagrams and text, “bit 0” refers
to the <em>most significant</em> bit of a word; “bit 31” is thus the least
significant bit of a 32 bit word.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>  <span class="n">Ver</span>  <span class="o">|</span>       <span class="n">Message</span> <span class="n">ID</span>      <span class="o">|</span>      <span class="n">Type</span>     <span class="o">|</span>   <span class="n">Reserved</span>  <span class="o">|</span><span class="n">C</span><span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                            <span class="n">Length</span>                             <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<p>For BEP v1 the <strong>Version</strong> field is set to zero. Future versions with
incompatible message formats will increment the Version field. A message
with an unknown version is a protocol error and MUST result in the
connection being terminated. A client supporting multiple versions MAY
retry with a different protocol version upon disconnection.</p>
<p>The <strong>Message ID</strong> is set to a unique value for each transmitted Request
message. In Response messages it is set to the Message ID of the corresponding
Request message. The uniqueness requirement implies that no more than 4096
request messages may be outstanding at any given moment. For message types
that do not have a corresponding response (Cluster Configuration, Index, etc.)
the Message ID field is irrelevant and SHOULD be set to zero.</p>
<p>The <strong>Type</strong> field indicates the type of data following the message header
and is one of the integers defined below. A message of an unknown type
is a protocol error and MUST result in the connection being terminated.</p>
<p>The <strong>Compression</strong> bit “C” indicates the compression used for the message.</p>
<p>For C=0:</p>
<ul class="simple">
<li><p>The Length field contains the length, in bytes, of the uncompressed
message data.</p></li>
<li><p>The message is not compressed.</p></li>
</ul>
<p>For C=1:</p>
<ul class="simple">
<li><p>The Length field contains the length, in bytes, of the compressed
message data plus a four byte uncompressed length field.</p></li>
<li><p>The compressed message data is preceeded by a 32 bit field denoting
the length of the uncompressed message.</p></li>
<li><p>The message data is compressed using the LZ4 format and algorithm
described in <a class="reference external" href="http://www.lz4.org/">http://www.lz4.org/</a>.</p></li>
</ul>
<p>All data within the message (post decompression, if compression is in
use) MUST be in XDR (RFC 1014) encoding. All fields shorter than 32 bits
and all variable length data MUST be padded to a multiple of 32 bits.
The actual data types in use by BEP, in XDR naming convention, are the
following:</p>
<dl class="simple">
<dt>(unsigned) int:</dt><dd><p>(unsigned) 32 bit integer</p>
</dd>
<dt>(unsigned) hyper:</dt><dd><p>(unsigned) 64 bit integer</p>
</dd>
<dt>opaque&lt;&gt;</dt><dd><p>variable length opaque data</p>
</dd>
<dt>string&lt;&gt;</dt><dd><p>variable length string</p>
</dd>
</dl>
<p>The transmitted length of string and opaque data is the length of actual
data, excluding any added padding. The encoding of opaque&lt;&gt; and string&lt;&gt;
are identical, the distinction being solely one of interpretation.
Opaque data should not be interpreted but can be compared bytewise to
other opaque data. All strings MUST use the Unicode UTF-8 encoding,
normalization form C.</p>
<section id="cluster-config-type-0">
<h3>Cluster Config (Type = 0)<a class="headerlink" href="#cluster-config-type-0" title="Permalink to this headline">¶</a></h3>
<p>This informational message provides information about the cluster
configuration as it pertains to the current connection. A Cluster Config
message MUST be the first message sent on a BEP connection. Additional
Cluster Config messages MUST NOT be sent after the initial exchange.</p>
<section id="graphical-representation">
<h4>Graphical Representation<a class="headerlink" href="#graphical-representation" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ClusterConfigMessage</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                     <span class="n">Length</span> <span class="n">of</span> <span class="n">Device</span> <span class="n">Name</span>                     <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                 <span class="n">Device</span> <span class="n">Name</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                     <span class="n">Length</span> <span class="n">of</span> <span class="n">Client</span> <span class="n">Name</span>                     <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                 <span class="n">Client</span> <span class="n">Name</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                   <span class="n">Length</span> <span class="n">of</span> <span class="n">Client</span> <span class="n">Version</span>                    <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\               <span class="n">Client</span> <span class="n">Version</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Folders</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Folder</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Options</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Option</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">Folder</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                         <span class="n">Length</span> <span class="n">of</span> <span class="n">ID</span>                          <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                     <span class="n">ID</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                      \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Devices</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Device</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Flags</span>                             <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Options</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Option</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">Device</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                         <span class="n">Length</span> <span class="n">of</span> <span class="n">ID</span>                          <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                     <span class="n">ID</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                      \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Name</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Name</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                      <span class="n">Number</span> <span class="n">of</span> <span class="n">Addresses</span>                      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Length</span> <span class="n">of</span> <span class="n">Address</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                   <span class="n">Address</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                   \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                          <span class="n">Compression</span>                          <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                      <span class="n">Length</span> <span class="n">of</span> <span class="n">Cert</span> <span class="n">Name</span>                      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                  <span class="n">Cert</span> <span class="n">Name</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                  \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                  <span class="n">Max</span> <span class="n">Local</span> <span class="n">Version</span> <span class="p">(</span><span class="mi">64</span> <span class="n">bits</span><span class="p">)</span>                  <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Flags</span>                             <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Options</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Option</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">Option</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                         <span class="n">Length</span> <span class="n">of</span> <span class="n">Key</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                     <span class="n">Key</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Value</span>                        <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Value</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                    \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="fields-clusterconfigmessage">
<h4>Fields (ClusterConfigMessage)<a class="headerlink" href="#fields-clusterconfigmessage" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Device Name</strong> is a human readable (configured or auto detected) device
name or host name, for the sending device.</p>
<p>The <strong>Client Name</strong> and <strong>Client Version</strong> identifies the implementation. The
values SHOULD  be simple strings identifying the implementation name, as a
user would expect to see it, and the version string in the same manner. An
example Client Name is “syncthing” and an example Client Version is “v0.7.2”.
The Client Version field SHOULD follow the patterns laid out in the <a class="reference external" href="http://semver.org/">Semantic
Versioning</a> standard.</p>
<p>The <strong>Folders</strong> field contains the list of folders that will be synchronized
over the current connection.</p>
<p>The <strong>Options</strong> field is a list of options that apply to the current
connection. The options are used in an implementation specific manner. The
options list is conceptually a map of keys to values, although it is
transmitted in the form of a list of key and value pairs, both of string type.
Key ID:s are implementation specific. An implementation MUST ignore unknown
keys. An implementation MAY impose limits on the length keys and values. The
options list may be used to inform devices of relevant local configuration
options such as rate limiting or make recommendations about request
parallelism, device priorities, etc. An empty options list is valid for
devices not having any such information to share. Devices MAY NOT make any
assumptions about peers acting in a specific manner as a result of sent
options.</p>
</section>
<section id="fields-folder-structure">
<h4>Fields (Folder Structure)<a class="headerlink" href="#fields-folder-structure" title="Permalink to this headline">¶</a></h4>
<p>The <strong>ID</strong> field contains the folder ID, as a human readable string.</p>
<p>The <strong>Devices</strong> field is list of devices participating in sharing this folder.</p>
<p>The <strong>Flags</strong> field contains flags that affect the behavior of the folder. The
folder Flags field contains the following single bit flags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Reserved</span>                          <span class="o">|</span><span class="n">D</span><span class="o">|</span><span class="n">P</span><span class="o">|</span><span class="n">R</span><span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Bit 31 (“R”, Read Only)</dt>
<dd class="field-odd"><p>is set for folders that the device will accept no updates from the network
for.</p>
</dd>
<dt class="field-even">Bit 30 (“P”, Ignore Permissions)</dt>
<dd class="field-even"><p>is set for folders that the device will not accept or announce file
permissions for.</p>
</dd>
<dt class="field-odd">Bit 29 (“D”, Ignore Deletes)</dt>
<dd class="field-odd"><p>is set for folders that the device will ignore deletes for.</p>
</dd>
</dl>
<p>The <strong>Options</strong> field contains a list of options that apply to the folder.</p>
</section>
<section id="fields-device-structure">
<h4>Fields (Device Structure)<a class="headerlink" href="#fields-device-structure" title="Permalink to this headline">¶</a></h4>
<p>The device <strong>ID</strong> field is a 32 byte number that uniquely identifies the
device. For instance, the reference implementation uses the SHA-256 of the
device X.509 certificate.</p>
<p>The <strong>Name</strong> field is a human readable name assigned to the described device
by the sending device. It MAY be empty and it need not be unique.</p>
<p>The list of <strong>Addressess</strong> is that used by the sending device to connect to
the described device.</p>
<p>The <strong>Compression</strong> field indicates the compression mode in use for this
device and folder. The following values are valid:</p>
<dl class="field-list simple">
<dt class="field-odd">0</dt>
<dd class="field-odd"><p>Compress metadata. This enables compression of metadata messages such as Index.</p>
</dd>
<dt class="field-even">1</dt>
<dd class="field-even"><p>Compression disabled. No compression is used on any message.</p>
</dd>
<dt class="field-odd">2</dt>
<dd class="field-odd"><p>Compress always. Metadata messages as well as Response messages are compressed.</p>
</dd>
</dl>
<p>The <strong>Cert Name</strong> field indicates the expected certificate name for this
device. It is commonly blank, indicating to use the implementation default.</p>
<p>The <strong>Max Local Version</strong> field contains the highest local file
version number of the files already known to be in the index sent by
this device. If nothing is known about the index of a given device, this
field MUST be set to zero. When receiving a Cluster Config message with
a non-zero Max Local Version for the local device ID, a device MAY elect
to send an Index Update message containing only files with higher local
version numbers in place of the initial Index message.</p>
<p>The <strong>Flags</strong> field indicates the sharing mode of the folder and other device
&amp; folder specific settings. See the discussion on Sharing Modes. The Device
Flags field contains the following single bit flags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>          <span class="n">Reserved</span>         <span class="o">|</span><span class="n">Pri</span><span class="o">|</span>          <span class="n">Reserved</span>       <span class="o">|</span><span class="n">I</span><span class="o">|</span><span class="n">R</span><span class="o">|</span><span class="n">T</span><span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Bit 31 (“T”, Trusted)</dt>
<dd class="field-odd"><p>is set for devices that participate in trusted
mode.</p>
</dd>
<dt class="field-even">Bit 30 (“R”, Read Only)</dt>
<dd class="field-even"><p>is set for devices that participate in read
only mode.</p>
</dd>
<dt class="field-odd">Bit 29 (“I”, Introducer)</dt>
<dd class="field-odd"><p>is set for devices that are trusted as
cluster introducers.</p>
</dd>
<dt class="field-even">Bits 16 through 28</dt>
<dd class="field-even"><p>are reserved and MUST be set to zero.</p>
</dd>
<dt class="field-odd">Bits 14-15 (“Pri)</dt>
<dd class="field-odd"><p>indicate the device’s upload priority for this
folder. Possible values are:</p>
<dl class="field-list simple">
<dt class="field-odd">00</dt>
<dd class="field-odd"><p>The default. Normal priority.</p>
</dd>
<dt class="field-even">01</dt>
<dd class="field-even"><p>High priority. Other devices SHOULD favour requesting files
from this device over devices with normal or low priority.</p>
</dd>
<dt class="field-odd">10</dt>
<dd class="field-odd"><p>Low priority. Other devices SHOULD avoid requesting files from
this device when they are available from other devices.</p>
</dd>
<dt class="field-even">11</dt>
<dd class="field-even"><p>Sharing disabled. Other devices SHOULD NOT request files from
this device.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Bits 0 through 14</dt>
<dd class="field-even"><p>are reserved and MUST be set to zero.</p>
</dd>
</dl>
<p>Exactly one of the T and R bits MUST be set.</p>
<p>The <strong>Options</strong> field contains a list of options that apply to the device.</p>
</section>
<section id="xdr">
<h4>XDR<a class="headerlink" href="#xdr" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">ClusterConfigMessage</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">DeviceName</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">ClientName</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">ClientVersion</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">Folder</span> <span class="n">Folders</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">Option</span> <span class="n">Options</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">Folder</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">ID</span><span class="o">&lt;</span><span class="mi">256</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">Device</span> <span class="n">Devices</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Flags</span><span class="p">;</span>
    <span class="n">Option</span> <span class="n">Options</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">Device</span> <span class="p">{</span>
    <span class="n">opaque</span> <span class="n">ID</span><span class="o">&lt;</span><span class="mi">32</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">Name</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">Addresses</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Compression</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">CertName</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">hyper</span> <span class="n">MaxLocalVersion</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Flags</span><span class="p">;</span>
    <span class="n">Option</span> <span class="n">Options</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">Option</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">Key</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">Value</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="index-type-1-and-index-update-type-6">
<h3>Index (Type = 1) and Index Update (Type = 6)<a class="headerlink" href="#index-type-1-and-index-update-type-6" title="Permalink to this headline">¶</a></h3>
<p>The Index and Index Update messages define the contents of the senders
folder. An Index message represents the full contents of the folder and
thus supersedes any previous index. An Index Update amends an existing
index with new information, not affecting any entries not included in
the message. An Index Update MAY NOT be sent unless preceded by an
Index, unless a non-zero Max Local Version has been announced for the
given folder by the peer device.</p>
<section id="id1">
<h4>Graphical Representation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IndexMessage</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Length</span> <span class="n">of</span> <span class="n">Folder</span>                        <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                   <span class="n">Folder</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                    \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Number</span> <span class="n">of</span> <span class="n">Files</span>                        <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\               <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">FileInfo</span> <span class="n">Structures</span>                \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Flags</span>                             <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Options</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Option</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">FileInfo</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Name</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Name</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Flags</span>                             <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                      <span class="n">Modified</span> <span class="p">(</span><span class="mi">64</span> <span class="n">bits</span><span class="p">)</span>                       <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                   <span class="n">Version</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                   \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                    <span class="n">Local</span> <span class="n">Version</span> <span class="p">(</span><span class="mi">64</span> <span class="n">bits</span><span class="p">)</span>                    <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Blocks</span>                        <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\               <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">BlockInfo</span> <span class="n">Structures</span>               \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">Vector</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                      <span class="n">Number</span> <span class="n">of</span> <span class="n">Counters</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Counter</span> <span class="n">Structures</span>                \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>

<span class="n">Counter</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                          <span class="n">ID</span> <span class="p">(</span><span class="mi">64</span> <span class="n">bits</span><span class="p">)</span>                         <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                        <span class="n">Value</span> <span class="p">(</span><span class="mi">64</span> <span class="n">bits</span><span class="p">)</span>                        <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>


<span class="n">BlockInfo</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Size</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Hash</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Hash</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="fields-index-message">
<h4>Fields (Index Message)<a class="headerlink" href="#fields-index-message" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Folder</strong> field identifies the folder that the index message pertains to.</p>
<p><strong>Files</strong></p>
<p>The <strong>Flags</strong> field is reserved for future use and MUST currently be set to
zero.</p>
<p>The <strong>Options</strong> list is implementation defined and as described in the
ClusterConfig message section.</p>
</section>
<section id="fields-fileinfo-structure">
<h4>Fields (FileInfo Structure)<a class="headerlink" href="#fields-fileinfo-structure" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Name</strong> is the file name path relative to the folder root. Like all
strings in BEP, the Name is always in UTF-8 NFC regardless of operating
system or file system specific conventions. The Name field uses the
slash character (“/”) as path separator, regardless of the
implementation’s operating system conventions. The combination of Folder
and Name uniquely identifies each file in a cluster.</p>
<p>The <strong>Flags</strong> field is made up of the following single bit flags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>              <span class="n">Reserved</span>       <span class="o">|</span><span class="n">U</span><span class="o">|</span><span class="n">S</span><span class="o">|</span><span class="n">P</span><span class="o">|</span><span class="n">I</span><span class="o">|</span><span class="n">D</span><span class="o">|</span>   <span class="n">Unix</span> <span class="n">Perm</span><span class="o">.</span> <span class="o">&amp;</span> <span class="n">Mode</span>   <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">The lower 12 bits</dt>
<dd class="field-odd"><p>hold the common Unix permission and mode bits. An
implementation MAY ignore or interpret these as is suitable on the
host operating system.</p>
</dd>
<dt class="field-even">Bit 19 (“D”)</dt>
<dd class="field-even"><p>is set when the file has been deleted. The block list
SHALL be of length zero and the modification time indicates the time
of deletion or, if the time of deletion is not reliably determinable,
the last known modification time.</p>
</dd>
<dt class="field-odd">Bit 18 (“I”)</dt>
<dd class="field-odd"><p>is set when the file is invalid and unavailable for
synchronization. A peer MAY set this bit to indicate that it can
temporarily not serve data for the file.</p>
</dd>
<dt class="field-even">Bit 17 (“P”)</dt>
<dd class="field-even"><p>is set when there is no permission information for the
file. This is the case when it originates on a file system which
does not support permissions. Changes to only permission bits SHOULD
be disregarded on files with this bit set. The permissions bits MUST
be set to the octal value 0666.</p>
</dd>
<dt class="field-odd">Bit 16 (“S”)</dt>
<dd class="field-odd"><p>is set when the file is a symbolic link. The block list
SHALL be of one or more blocks since the target of the symlink is
stored within the blocks of the file.</p>
</dd>
<dt class="field-even">Bit 15 (“U”)</dt>
<dd class="field-even"><p>is set when the symbolic links target does not exist. On
systems where symbolic links have types, this bit being means that
the default file symlink SHALL be used. If this bit is unset bit 19
will decide the type of symlink to be created.</p>
</dd>
<dt class="field-odd">Bit 0 through 14</dt>
<dd class="field-odd"><p>are reserved for future use and SHALL be set to
zero.</p>
</dd>
</dl>
<p>The <strong>Modified</strong> time is expressed as the number of seconds since the Unix
Epoch (1970-01-01 00:00:00 UTC).</p>
<p>The <strong>Version</strong> field is a version vector describing the updates performed
to a file by all members in the cluster. Each counter in the version
vector is an ID-Value tuple. The ID is used the first 64 bits of the
device ID. The Value is a simple incrementing counter, starting at zero.
The combination of Folder, Name and Version uniquely identifies the
contents of a file at a given point in time.</p>
<p>The <strong>Local Version</strong> field is the value of a device local monotonic clock
at the time of last local database update to a file. The clock ticks on
every local database update.</p>
<p>The <strong>Blocks</strong> list contains the size and hash for each block in the file.
Each block represents a 128 KiB slice of the file, except for the last
block which may represent a smaller amount of data.</p>
<p>The hash algorithm is implied by the <strong>Hash</strong> length. Currently, the hash
MUST be 32 bytes long and computed by SHA256.</p>
</section>
<section id="id2">
<h4>XDR<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">IndexMessage</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">Folder</span><span class="o">&lt;</span><span class="mi">256</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">FileInfo</span> <span class="n">Files</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Flags</span><span class="p">;</span>
    <span class="n">Option</span> <span class="n">Options</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">FileInfo</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">Name</span><span class="o">&lt;</span><span class="mi">8192</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Flags</span><span class="p">;</span>
    <span class="n">hyper</span> <span class="n">Modified</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">Version</span><span class="p">;</span>
    <span class="n">hyper</span> <span class="n">LocalVersion</span><span class="p">;</span>
    <span class="n">BlockInfo</span> <span class="n">Blocks</span><span class="o">&lt;</span><span class="mi">1000000</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">Vector</span> <span class="p">{</span>
    <span class="n">Counter</span> <span class="n">Counters</span><span class="o">&lt;&gt;</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">Counter</span> <span class="p">{</span>
    <span class="n">unsigned</span> <span class="n">hyper</span> <span class="n">ID</span>
    <span class="n">unsigned</span> <span class="n">hyper</span> <span class="n">Value</span>
<span class="p">}</span>

<span class="n">struct</span> <span class="n">BlockInfo</span> <span class="p">{</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Size</span><span class="p">;</span>
    <span class="n">opaque</span> <span class="n">Hash</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="request-type-2">
<h3>Request (Type = 2)<a class="headerlink" href="#request-type-2" title="Permalink to this headline">¶</a></h3>
<p>The Request message expresses the desire to receive a data block
corresponding to a part of a certain file in the peer’s folder.</p>
<section id="id3">
<h4>Graphical Representation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RequestMessage</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Length</span> <span class="n">of</span> <span class="n">Folder</span>                        <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                   <span class="n">Folder</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                    \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Name</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Name</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                       <span class="n">Offset</span> <span class="p">(</span><span class="mi">64</span> <span class="n">bits</span><span class="p">)</span>                        <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Size</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Hash</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Hash</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Flags</span>                             <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Number</span> <span class="n">of</span> <span class="n">Options</span>                       <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                <span class="n">Zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">Option</span> <span class="n">Structures</span>                 \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="fields">
<h4>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h4>
<p>The Folder and Name fields are as documented for the Index message. The
Offset and Size fields specify the region of the file to be transferred.
This SHOULD equate to exactly one block as seen in an Index message.</p>
<p>The Hash field MAY be set to the expected hash value of the block, or
may be left empty (zero length). If set, the other device SHOULD ensure
that the transmitted block matches the requested hash. The other device
MAY reuse a block from a different file and offset having the same size
and hash, if one exists.</p>
<p>The Flags field is reserved for future use and MUST currently be set to
zero. The Options list is implementation defined and as described in the
ClusterConfig message section.</p>
</section>
<section id="id4">
<h4>XDR<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">RequestMessage</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">Folder</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">Name</span><span class="o">&lt;</span><span class="mi">8192</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">hyper</span> <span class="n">Offset</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">Size</span><span class="p">;</span>
    <span class="n">opaque</span> <span class="n">Hash</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">Flags</span><span class="p">;</span>
    <span class="n">Option</span> <span class="n">Options</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="response-type-3">
<h3>Response (Type = 3)<a class="headerlink" href="#response-type-3" title="Permalink to this headline">¶</a></h3>
<p>The Response message is sent in response to a Request message.</p>
<section id="id5">
<h4>Graphical Representation<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>ResponseMessage Structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                        <span class="n">Length</span> <span class="n">of</span> <span class="n">Data</span>                         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                    <span class="n">Data</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                     \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Code</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="id6">
<h4>Fields<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Data</strong> field contains either a full 128 KiB block, a shorter block in
the case of the last block in a file, or is empty (zero length) if the
requested block is not available.</p>
<p>The <strong>Code</strong> field contains an error code describing the reason a Request
could not be fulfilled, in the case where a zero length Data was
returned. The following values are defined:</p>
<dl class="field-list simple">
<dt class="field-odd">0</dt>
<dd class="field-odd"><p>No Error (Data should be present)</p>
</dd>
<dt class="field-even">1</dt>
<dd class="field-even"><p>Generic Error</p>
</dd>
<dt class="field-odd">2</dt>
<dd class="field-odd"><p>No Such File (the requested file does not exist, or the offset is
outside the acceptable range for the file)</p>
</dd>
<dt class="field-even">3</dt>
<dd class="field-even"><p>Invalid (file exists but has invalid bit set or is otherwise
unavailable)</p>
</dd>
</dl>
</section>
<section id="id7">
<h4>XDR<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">ResponseMessage</span> <span class="p">{</span>
    <span class="n">opaque</span> <span class="n">Data</span><span class="o">&lt;&gt;</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">Code</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="ping-type-4">
<h3>Ping (Type = 4)<a class="headerlink" href="#ping-type-4" title="Permalink to this headline">¶</a></h3>
<p>The Ping message is used to determine that a connection is alive, and to keep
connections alive through state tracking network elements such as firewalls
and NAT gateways. The Ping message has no contents. A Ping message is sent
every 90 seconds, if no other message has been sent in the preceding 90
seconds.</p>
</section>
<section id="close-type-7">
<h3>Close (Type = 7)<a class="headerlink" href="#close-type-7" title="Permalink to this headline">¶</a></h3>
<p>The Close message MAY be sent to indicate that the connection will be
torn down due to an error condition. A Close message MUST NOT be
followed by further messages.</p>
<section id="id8">
<h4>Graphical Representation<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CloseMessage</span> <span class="n">Structure</span><span class="p">:</span>

 <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">Length</span> <span class="n">of</span> <span class="n">Reason</span>                        <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
\                   <span class="n">Reason</span> <span class="p">(</span><span class="n">variable</span> <span class="n">length</span><span class="p">)</span>                    \
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                             <span class="n">Code</span>                              <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="id9">
<h4>Fields<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Reason</strong> field contains a human description of the error condition,
suitable for consumption by a human. The <strong>Code</strong> field is for a machine
readable error code. Codes are reserved for future use and MUST
currently be set to zero.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">CloseMessage</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">Reason</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">Code</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="sharing-modes">
<h2>Sharing Modes<a class="headerlink" href="#sharing-modes" title="Permalink to this headline">¶</a></h2>
<section id="trusted">
<h3>Trusted<a class="headerlink" href="#trusted" title="Permalink to this headline">¶</a></h3>
<p>Trusted mode is the default sharing mode. Updates are exchanged in both
directions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------+</span>     <span class="n">Updates</span>      <span class="o">/---------</span>\
<span class="o">|</span>            <span class="o">|</span>  <span class="o">-----------&gt;</span>   <span class="o">/</span>           \
<span class="o">|</span>   <span class="n">Device</span>   <span class="o">|</span>                 <span class="o">|</span>  <span class="n">Cluster</span>  <span class="o">|</span>
<span class="o">|</span>            <span class="o">|</span>  <span class="o">&lt;-----------</span>   \           <span class="o">/</span>
<span class="o">+------------+</span>     <span class="n">Updates</span>      \<span class="o">---------/</span>
</pre></div>
</div>
</section>
<section id="read-only">
<h3>Read Only<a class="headerlink" href="#read-only" title="Permalink to this headline">¶</a></h3>
<p>In read only mode, a device does not synchronize the local folder to the
cluster, but publishes changes to its local folder contents as usual.
The local folder can be seen as a “master copy” that is never affected
by the actions of other cluster devices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------+</span>     <span class="n">Updates</span>      <span class="o">/---------</span>\
<span class="o">|</span>            <span class="o">|</span>  <span class="o">-----------&gt;</span>   <span class="o">/</span>           \
<span class="o">|</span>   <span class="n">Device</span>   <span class="o">|</span>                 <span class="o">|</span>  <span class="n">Cluster</span>  <span class="o">|</span>
<span class="o">|</span>            <span class="o">|</span>                 \           <span class="o">/</span>
<span class="o">+------------+</span>                  \<span class="o">---------/</span>
</pre></div>
</div>
</section>
</section>
<section id="message-limits">
<h2>Message Limits<a class="headerlink" href="#message-limits" title="Permalink to this headline">¶</a></h2>
<p>An implementation MAY impose reasonable limits on the length of messages
and message fields to aid robustness in the face of corruption or broken
implementations. These limits, if imposed, SHOULD NOT be more
restrictive than the following. An implementation should strive to keep
messages short and to the point, favouring more and smaller messages
over fewer and larger. For example, favour a smaller Index message
followed by one or more Index Update messages rather than sending a very
large Index message.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 37%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Message Type</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Limit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><strong>All Messages</strong></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Total length</p></td>
<td><p>64 MiB</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Index and Index Update Messages</strong></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Folder</p></td>
<td><p>64 bytes</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Number of Files</p></td>
<td><p>1.000.000</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Name</p></td>
<td><p>8192 bytes</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Number of Blocks</p></td>
<td><p>1.000.000</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Hash</p></td>
<td><p>64 bytes</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Number of Counters</p></td>
<td><p>1.000.000</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p><strong>Request Messages</strong></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Folder</p></td>
<td><p>64 bytes</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Name</p></td>
<td><p>8192 bytes</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Response Messages</strong></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Data</p></td>
<td><p>256 KiB</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p><strong>Cluster Config Message</strong></p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Number of Folders</p></td>
<td><p>1.000.000</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Number of Devices</p></td>
<td><p>1.000.000</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Number of Options</p></td>
<td><p>64</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Key</p></td>
<td><p>64 bytes</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
</div>
</td>
<td><p>Value</p></td>
<td><p>1024 bytes</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-exchange">
<h2>Example Exchange<a class="headerlink" href="#example-exchange" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 48%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>ClusterConfiguration-&gt;</p></td>
<td><p>&lt;-ClusterConfiguration</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Index-&gt;</p></td>
<td><p>&lt;-Index</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>IndexUpdate-&gt;</p></td>
<td><p>&lt;-IndexUpdate</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>IndexUpdate-&gt;</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Request-&gt;</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Request-&gt;</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>Request-&gt;</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>Request-&gt;</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td></td>
<td><p>&lt;-Response</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td></td>
<td><p>&lt;-Response</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td></td>
<td><p>&lt;-Response</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td></td>
<td><p>&lt;-Response</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>Index Update-&gt;</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td></td>
<td><p>&lt;-Ping</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>Ping-&gt;</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The connection is established and at 1. both peers send ClusterConfiguration
messages and then Index records. The Index records are received and both peers
recompute their knowledge of the data in the cluster. In this example, peer A
has four missing or outdated blocks. At 5 through 8 peer A sends requests for
these blocks. The requests are received by peer B, who retrieves the data from
the folder and transmits Response records (9 through 12). Device A updates
their folder contents and transmits an Index Update message (13). Both peers
enter idle state after 13. At some later time 14, the ping timer on device B
expires and a Ping message is sent. The same process occurs for device A at
15.</p>
</section>
<section id="examples-of-strong-cipher-suites">
<h2>Examples of Strong Cipher Suites<a class="headerlink" href="#examples-of-strong-cipher-suites" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 40%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x009F</p></td>
<td><p>DHE-RSA-AES256-GCM-SHA384</p></td>
<td><p>TLSv1.2 DH RSA AESGCM(256) AEAD</p></td>
</tr>
<tr class="row-odd"><td><p>0x006B</p></td>
<td><p>DHE-RSA-AES256-SHA256</p></td>
<td><p>TLSv1.2 DH RSA AES(256) SHA256</p></td>
</tr>
<tr class="row-even"><td><p>0xC030</p></td>
<td><p>ECDHE-RSA-AES256-GCM-SHA384</p></td>
<td><p>TLSv1.2 ECDH RSA AESGCM(256) AEAD</p></td>
</tr>
<tr class="row-odd"><td><p>0xC028</p></td>
<td><p>ECDHE-RSA-AES256-SHA384</p></td>
<td><p>TLSv1.2 ECDH RSA AES(256) SHA384</p></td>
</tr>
<tr class="row-even"><td><p>0x009E</p></td>
<td><p>DHE-RSA-AES128-GCM-SHA256</p></td>
<td><p>TLSv1.2 DH RSA AESGCM(128) AEAD</p></td>
</tr>
<tr class="row-odd"><td><p>0x0067</p></td>
<td><p>DHE-RSA-AES128-SHA256</p></td>
<td><p>TLSv1.2 DH RSA AES(128) SHA256</p></td>
</tr>
<tr class="row-even"><td><p>0xC02F</p></td>
<td><p>ECDHE-RSA-AES128-GCM-SHA256</p></td>
<td><p>TLSv1.2 ECDH RSA AESGCM(128) AEAD</p></td>
</tr>
<tr class="row-odd"><td><p>0xC027</p></td>
<td><p>ECDHE-RSA-AES128-SHA256</p></td>
<td><p>TLSv1.2 ECDH RSA AES(128) SHA256</p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="globaldisco-v3.html" class="btn btn-neutral float-right" title="Global Discovery v3" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Specifications" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      Last updated on Jan 30, 2022.
    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v0.12',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/version_redirect.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>